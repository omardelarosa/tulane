(function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};null==this.Fontana&&(this.Fontana={}),null==(a=this.Fontana).datasources&&(a.datasources={}),this.Fontana.datasources.Static=function(){function a(a){this.messages=null!=a?a:[]}return a.prototype.setMessages=function(a){return null==this.messages&&(this.messages=[]),this.mesages=a.concat(this.mesages)},a.prototype.getMessages=function(a){return a?setTimeout(function(b){return function(){return a(b.messages)}}(this),0):void 0},a}(),this.Fontana.datasources.HTML=function(){function a(a){this.container=a,this.messages=[]}return a.prototype.extractMessages=function(){var a;return a=[],$(".message",this.container).each(function(b,c){return a.push({id:c.id,created_at:(new Date).toString(),text:$(".text",c).text(),user:{name:$(".name",c).text(),screen_name:$(".screen_name",c).text().replace(/^@/,""),profile_image_url:$(".avatar",c).attr("src")}})}),a},a.prototype.getMessages=function(a){var c,d,e;return c=[function(){var a,b,c,e;for(c=this.messages,e=[],a=0,b=c.length;b>a;a++)d=c[a],e.push(d.id);return e}.call(this)],e=[],this.extractMessages().forEach(function(a){var d;return d=a.id,b.call(c,d)<0?e.push(a):void 0}),this.messages=e.concat(this.messages),a?setTimeout(function(b){return function(){return a(b.messages)}}(this),0):void 0},a}(),this.Fontana.datasources.TwitterSearch=function(){function a(a){this.q=a,this.params={since_id:1,q:this.q,result_type:"recent"},this.lastCall=0,this.messages=[],this.getJSON=$.getJSON("/api/twitter/search/",this.params)}var b;return b=5e3,a.prototype.getMessages=function(a){var c;return c=(new Date).getTime(),c-this.lastCall<b?a?setTimeout(function(b){return function(){return a(b.messages)}}(this),0):void 0:(this.lastCall=(new Date).getTime(),this.getJSON.success(function(b){return function(c){return c.statuses.length&&(b.messages=c.statuses.concat(b.messages),b.params.since_id=b.messages[0].id_str),a?a(b.messages.length?b.messages:[{id:(new Date).getTime(),created_at:(new Date).toString(),text:"Your search term returned no Tweets :(",user:{name:"Twitter Fontana",screen_name:"twitterfontana",profile_image_url:"/img/avatar.png"}}]):void 0}}(this)).error(function(){return a?a([{id:(new Date).getTime(),created_at:(new Date).toString(),text:"Error fetching tweets :(",user:{name:"Twitter Fontana",screen_name:"twitterfontana",profile_image_url:"/img/avatar.png"}}]):void 0}))},a}(),this.Fontana.datasources.TwitterSearchFA=function(a){function b(a,c,d){this.q=a,this.http=c,this.url=d,b.__super__.constructor.call(this,this.q),null==this.url&&(this.url="https://api.twitter.com/1.1/search/tweets.json"),this.getJSON=this.http.get({url:this.url,data:this.params,dataType:"json"})}return d(b,a),b}(this.Fontana.datasources.TwitterSearch)}).call(this),function(){var a,b,c;null==this.Fontana&&(this.Fontana={}),null==(c=this.Fontana).utils&&(c.utils={}),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.Fontana.utils.prettyDate=function(b){var c,d,e,f;return c=new Date(b),f=(new Date).getTime(),e=(f-c.getTime())/1e3,d=Math.floor(e/86400),isNaN(c)?b:isNaN(d)||0>d||d>=1?365>=d?""+c.getDate()+" "+a[c.getMonth()]:""+c.getDate()+" "+a[c.getMonth()]+" "+c.getFullYear():!d&&10>e?"just now":!d&&60>e?""+Math.floor(e)+"s":!d&&3600>e?""+Math.floor(e/60)+"m":!d&&86400>e?""+Math.floor(e/3600)+"h":void 0},b=["webkit","moz","ms"],this.Fontana.utils.requestFullScreen=function(a){var c;return c=a.requestFullscreen||a.requestFullScreen,b.some(function(b){return null==c&&(c=a[b+"RequestFullScreen"]),!!c}),c?c.call(a,Element.ALLOW_KEYBOARD_INPUT):void 0},this.Fontana.utils.cancelFullScreen=function(){var a;return a=document.exitFullscreen||document.cancelFullScreen,b.some(function(b){return null==a&&(a=document[b+"CancelFullScreen"]),!!a}),a?a.call(document):void 0},this.Fontana.utils.isFullScreen=function(){var a;return a=document.fullScreen||document.isFullScreen,b.some(function(b){return null==a&&(a=document[b+"FullScreen"]||document[b+"IsFullScreen"]),!!a}),!!a}}.call(this),function(){var a,b;null==this.Fontana&&(this.Fontana={}),a='<div id="{id}" class="message media well col-md-6 col-md-offset-3"> <figure class="pull-left media-object"> <img src="{user.profile_image_url}" width="64" height="64" alt="" class="avatar img-thumbnail"> </figure> <div class="media-body"> <div class="media-heading"> <cite> <span class="name">{user.name}</span> <small class="text-muted"> <span class="screen_name">@{user.screen_name}</span> <time class="time pull-right" data-time="{created_at}">{created_at}</time> </small> </cite> </div> <div class="text lead"><q>{text}</q></div> </div> </div>',b=["compress","fade-in","hinge","lightspeed","scroll-up","scroll-down","slide","tilt-scroll","vertigo","zoom-in"],Fontana.Visualizer=function(){function c(a,b){this.container=a,this.datasource=b,this.paused=!1,this.fetchMessagesTimer=-1,this.animationTimer=-1}return c.prototype.start=function(a){return this.fetchMessages(!0),this.container.empty(),this.config(a),this.scheduleUpdateAllTimes()},c.prototype.config=function(a){return b.forEach(function(a){return function(b){return a.container.removeClass(b)}}(this)),this.container.addClass(a&&a.transition&&b.indexOf(a.transition)>-1?a.transition:b[0])},c.prototype.pause=function(){return this.paused?void 0:(clearTimeout(this.fetchMessagesTimer),clearTimeout(this.animationTimer),this.paused=!0)},c.prototype.resume=function(){return this.paused?(this.fetchMessages(),this.animate(),this.paused=!1):void 0},c.prototype.stop=function(){return this.pause(),this.container.empty()},c.prototype.fetchMessages=function(a){return null==a&&(a=!1),this.datasource.getMessages(function(b){return function(c){return b.renderMessages(c,a),b.scheduleFetchMessages()}}(this))},c.prototype.renderMessages=function(b,c){return null==c&&(c=!1),b.reverse().forEach(function(b){return function(c){var d;return $("#"+c.id).length?void 0:(c.text=c.entities?twttr.txt.autoLinkWithJSON(c.text,c.entities,{targetBlank:!0}):twttr.txt.autoLink(c.text,{targetBlank:!0}),d=$(nano(a,c)),b.updateTime(d),b.container.prepend(d))}}(this)),c?this.scheduleAnimation():void 0},c.prototype.animate=function(){var a,b,c;return a=$(".message",this.container),a.removeClass("next next-one focus prev-one prev "),this.current=this.current&&this.current.next().length?this.current.next():$(".message:first",this.container),b=this.current.next(),b.length||(b=$(".message:first",this.container)),this.current.addClass("focus"),b.addClass("next-one"),b.nextAll(":not(.focus)").addClass("next"),c=this.current.prev(),c.length||(c=$(".message:last",this.container)),c.addClass("prev-one").removeClass("next"),c.prevAll(":not(.next-one):not(.next):not(.focus)").addClass("prev"),this.scheduleAnimation()},c.prototype.updateAllTimes=function(){return $(".message",this.container).each(function(a){return function(b,c){return a.updateTime(c)}}(this)),this.scheduleUpdateAllTimes()},c.prototype.updateTime=function(a){var b;return b=$(".time",a),b.text(Fontana.utils.prettyDate(b.data("time")))},c.prototype.scheduleAnimation=function(){var a;return a=-1===this.animationTimer?0:6e3,this.animationTimer=setTimeout(function(a){return function(){return a.animate()}}(this),a)},c.prototype.scheduleFetchMessages=function(){return this.fetchMessagesTimer=setTimeout(function(a){return function(){return a.fetchMessages()}}(this),3e4)},c.prototype.scheduleUpdateAllTimes=function(){return setTimeout(function(a){return function(){return a.updateAllTimes()}}(this),1e4)},c}(),this.Fontana.Visualizer.transitionEffects=b}.call(this);